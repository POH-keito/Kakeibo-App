# NocodeBackend API ガイドライン ([プロジェクト名])

このドキュメントは、[プロジェクト名]で利用する NocodeBackend API の仕様とベストプラクティスをまとめたものです。

## 概要と特徴

NocodeBackend は、コーディング不要で迅速に REST API を構築できる DBaaS（Database as a Service）です。V2 では UI/UX が刷新され、パフォーマンスが大幅に向上しました。

**主な特徴:**

- **迅速な開発:** 直感的な UI、複数テーブル/カラムの同時作成機能、AI アシスタントにより、API とデータベースのセットアップを数分で完了できます。
- **AI Builder:** 自然言語のプロンプトからデータベーススキーマ全体を自動生成できます。
- **Join サポート:** UI、SQL、AI を利用した 3 つの方法でテーブル結合が可能です。
- **手厚いサポート:** 開発チームの反応が非常に速く、ユーザーからの機能リクエストが短期間で実装されることがあります。

---

## 1. API 基本情報

| 項目               | 内容                                                                                      | 備考                                                    |
| :----------------- | :---------------------------------------------------------------------------------------- | :------------------------------------------------------ |
| **Base URL**       | `https://[あなたのプロジェクトID].nocodebackend.com/` <br> (例: `http://ncb.fukushi.ma/`) |                                                         |
| **認証**           | `Authorization: Bearer YOUR_API_KEY` ヘッダー                                             | 下記参照                                                |
| **レートリミット** | Tier 1: 20 リクエスト/10 秒                                                               | Tier 2 以上は無制限 (LTD プラン)                        |
| **DB エンジン**    | MySQL                                                                                     |                                                         |
| **サーバー所在地** | Oracle Cloud（1 サーバー）、AWS（EU 地域：ドイツ、US 地域：アメリカ）                     | 将来的にシンガポールやインドへの展開も検討中            |
| **データ型**       | Text, Integer, Boolean, Float, Drop-down, **Password**, Datetime                          | `JSON`型は開発中、`BLOB`型は非対応。下記「DB 仕様」参照 |
| **AI 統合**        | 独自の AI API キー持ち込みは不可                                                          | 将来的に BYOK (Bring Your Own Key) を検討中             |
| **バックアップ**   | 1 日 1 回の自動バックアップ、7 日間保持                                                   | 災害復旧(DR)目的                                        |

### 認証ヘッダー

| ヘッダー        | 値                    |
| :-------------- | :-------------------- |
| `Authorization` | `Bearer YOUR_API_KEY` |
| `Content-Type`  | `application/json`    |

---

## 2. API エンドポイント (テーブル例)

| テーブル名 | 説明               |
| :--------- | :----------------- |
| `users`    | ユーザー情報を格納 |
| `posts`    | 投稿情報を格納     |

### スキーマ例: `users`

| カラム名     | データ型   | 説明                                      |
| :----------- | :--------- | :---------------------------------------- |
| `id`         | `integer`  | レコード ID (Primary Key, Auto-increment) |
| `name`       | `string`   | 氏名                                      |
| `email`      | `string`   | メールアドレス                            |
| `password`   | `password` | パスワード (bcrypt で自動ハッシュ化)      |
| `created_at` | `datetime` | 作成日時                                  |
| `updated_at` | `datetime` | 更新日時                                  |

**注記:** `id`, `created_at`, `updated_at` はシステムによって自動的に管理されます。

---

## 3. API 操作

### 基本操作 (CRUD)

| 操作            | HTTP メソッド | エンドポイント例 | リクエストボディ例                                   |
| :-------------- | :------------ | :--------------- | :--------------------------------------------------- |
| **全件取得**    | `GET`         | `/users`         | なし                                                 |
| **ID 指定取得** | `GET`         | `/users/[id]`    | なし                                                 |
| **作成**        | `POST`        | `/users`         | `{"name": "山田 太郎", "email": "taro@example.com"}` |
| **更新**        | `PATCH`       | `/users/[id]`    | `{"name": "山田 太郎(更新)"}`                        |
| **削除**        | `DELETE`      | `/users/[id]`    | なし                                                 |

### 高度なクエリ

| パラメータ     | 説明                                 | 使用例                                                            |
| :------------- | :----------------------------------- | :---------------------------------------------------------------- |
| `where`        | 条件に一致するデータをフィルタリング | `?where=(email,eq,taro@example.com)` <br> `?where=(price,gt,100)` |
| `sort`         | 指定したカラムで結果を並び替え       | `?sort=(created_at,desc)`                                         |
| `limit`        | 取得するデータ件数を制限             | `?limit=10`                                                       |
| `page`         | ページネーション                     | `?page=2&limit=10`                                                |
| `includeTotal` | 総数とページ数をメタデータに含める   | `?page=1&limit=25&includeTotal=true`                              |
| `only`         | 最新または最古のレコードを 1 件取得  | `?only=latest&by=created_at` <br> `?only=oldest`                  |

### 高度なフィルタリング（クエリパラメータ）

クエリパラメータを使用して、より柔軟なフィルタリングが可能です。

| オペレーター | 説明                           | 使用例                               |
| :----------- | :----------------------------- | :----------------------------------- |
| `eq`         | 等しい                         | `?email[eq]=taro@example.com`        |
| `neq`        | 等しくない                     | `?status[neq]=inactive`              |
| `gt`         | より大きい                     | `?price[gt]=100`                     |
| `gte`        | 以上                           | `?manufactured_date[gte]=2025-08-01` |
| `lt`         | より小さい                     | `?price[lt]=1000`                    |
| `lte`        | 以下                           | `?manufactured_date[lte]=2025-08-10` |
| `in`         | 指定した値のいずれかに一致     | `?name[in]=value1,value2`            |
| `like`       | 部分一致（ワイルドカード検索） | `?name[like]=asp`                    |

**複数条件の組み合わせ例:**

- 日付範囲: `?manufactured_date[gte]=2025-03-01&manufactured_date[lte]=2025-08-10`
- 複数フィルター: `?manufactureDate[GTE]=2024-01-01&name[LIKE]=asp`

### 複数列ソート

複数のカラムでソートし、各カラムのソート方向を個別に指定可能です。

| パラメータ | 説明                                 | 使用例                                 |
| :--------- | :----------------------------------- | :------------------------------------- |
| `sort`     | ソート対象のカラム（カンマ区切り）   | `?sort=created_at,name`                |
| `order`    | 各カラムのソート方向（カンマ区切り） | `?sort=created_at,name&order=desc,asc` |

### Joins (テーブル結合)

複数のテーブルを結合した結果を返す専用エンドポイントを作成できます。

| 作成方法           | 説明                                         |
| :----------------- | :------------------------------------------- |
| **Create Join UI** | GUI 上で視覚的に Join を定義します。         |
| **SQL Query**      | SQL を直接記述して Join を定義します。       |
| **AI Builder**     | 自然言語で要件を記述して AI に生成させます。 |

---

## 4. セキュリティ

| 機能/プラクティス          | 説明                                                                                                         | 推奨事項                                                                                                                                                             |
| :------------------------- | :----------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Secret Key の管理**      | API キーの取り扱い                                                                                           | **最重要:** サーバーサイドの環境変数で管理し、クライアントサイドのコードに絶対に埋め込まない。                                                                       |
| **Password 型**            | `password`型で定義されたカラムは、書き込み時に自動で **bcrypt** を用いてハッシュ化され、平文は保存されない。 | ユーザーパスワードやトークンなど、秘匿性の高い文字列に使用する。ハッシュ化されるため検索やソートは不可。                                                             |
| **ドメインホワイトリスト** | アクセス元ドメインを制限する機能（2025 年 11 月 3 日実装済み）                                               | スコープ付きキーと組み合わせて多層防御を実現。ワイルドカード（`.example.com`）でサブドメインもカバー可能。My databases → ⋯ → Secret keys → "Allowed domains"で設定。 |
| **スコープ付きキー**       | 操作権限（CRUD）を限定したキーを発行（2025 年 9 月 29 日実装済み）                                           | 用途に応じてキーを使い分け、リスクを最小化する。                                                                                                                     |
| **行レベルセキュリティ**   | ネイティブサポートはなし。`WHERE`句とキーの組み合わせで擬似的に実現                                          | ユーザーごとのデータアクセス制御に利用。                                                                                                                             |

---

## 5. データベース仕様

| 項目                          | 仕様・説明                                                                                                                                                                                                                                                       |
| :---------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **エンジン**                  | MySQL                                                                                                                                                                                                                                                            |
| **接続方法**                  | API 経由のみ。直接の DB 認証情報（接続文字列など）は提供されない。                                                                                                                                                                                               |
| **データ型**                  | `Text`, `Integer`, `Boolean`, `Float`, `Drop-down`, `Password`, `Datetime` をサポート。数値型として `Smallint`, `Bigint`, `Double`, `Decimal` も利用可能。`JSON`型は開発中、`BLOB`型は未対応。                                                                   |
| **レコード制限**              | テーブルあたりのレコード数に厳密な上限はないが、100 万行を超えるとパフォーマンスが低下する可能性がある。                                                                                                                                                         |
| **AI Builder**                | 自然言語プロンプトから DB スキーマ、API、ドキュメントを自動生成する。プロトタイピングに強力だが、本番利用前にはインデックスや外部キーなどのレビューが必須。                                                                                                      |
| **Swagger JSON エクスポート** | API 仕様を Swagger (OpenAPI) JSON 形式でワンクリックでエクスポート可能。Greta、Cursor、Lovable などの AI コーディングツールとの連携に最適。                                                                                                                      |
| **Join (テーブル結合)**       | UI、SQL、AI の 3 つの方法でテーブル結合が可能。本番環境ではパフォーマンスのため明示的な外部キー設定を推奨。                                                                                                                                                      |
| **計算列**                    | AI を使用して自然言語で計算カラムを作成可能（例: "Price カラムの 50%を計算する discounted_price カラムを作成"）。カスタム SQL（`CREATE TABLE ... AS (price * quantity) STORED`）も使用可能。複雑な SQL やコードを書くことなく、AI が自動的に計算ロジックを実装。 |
| **インデックス**              | AI に依頼するか、SQL Playground で `CREATE INDEX` クエリを実行して手動で作成する必要がある。                                                                                                                                                                     |
| **データ入力**                | API 経由でのみ可能。CSV などのファイルアップロードによる一括インポートは不可。                                                                                                                                                                                   |
| **データ出力**                | データベース全体を `.sql` 形式でエクスポート可能（All databases → ⋯ → Export）。Records ページから CSV エクスポートも可能（2025 年 11 月 7 日実装済み、含めるカラムを選択してダウンロード）。クイックバックアップ、レポート作成、データ移行に最適。              |
| **Webhooks**                  | テーブルの変更（INSERT、UPDATE、DELETE）時に HTTP コールバックをトリガー可能（2025 年 11 月 9 日実装済み）。Developer settings → Webhooks で設定。データベースの変更を他のサービス（通知、ログ、同期など）に連携可能。                                           |
| **パスワードリセットメール**  | ネイティブサポート（2025 年 9 月 28 日実装済み）。SMTP 設定と API コマンドを自動生成。JWT トークン（15 分間有効）を使用したセキュアなパスワードリセットフローを実装可能。                                                                                        |

---

## 6. チーム機能とプラン

| 機能                      | 説明                                                                                                                                                             |
| :------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **チームメンバー招待**    | Tier 3 以上では、他のユーザーを招待してデータベースを共同で編集可能。                                                                                            |
| **カスタムドメイン**      | Tier 3 以上では、API ドキュメントを独自のドメイン/サブドメインで公開可能。各 Tier で 1 つのカスタムドメインが補完的に提供され、追加は$9/月のアドオンで購入可能。 |
| **AI Builder クレジット** | Tier 1: なし、Tier 2: 15、Tier 3: 50、Tier 4: 100、Tier 5: 250（すべて 1 回限りのクレジット）。追加クレジットは 100 回で$49 で購入可能。                         |
| **クレジット**            | 追加のデータベースや AI Agentic Call は、クレジットとして購入可能。                                                                                              |

---

## 7. ベストプラクティス

| プラクティス               | 説明                                                                                                                 |
| :------------------------- | :------------------------------------------------------------------------------------------------------------------- |
| **スキーマ設計**           | 大規模なデータを扱うテーブルには、パフォーマンス向上のため、外部キーやインデックスを適切に設計・設定する。           |
| **Password 型の利用**      | パスワードや API キーなどの機密データは必ず `password` 型を使用し、平文で保存しない。                                |
| **Join の活用**            | 複数のテーブルにまたがるデータを取得する際は、非正規化されたコピーを作成する代わりに Join エンドポイントを利用する。 |
| **クライアントサイド検証** | バックエンドの API だけでなく、フロントエンドでも入力値のバリデーションを行い、UX 向上と不要なリクエスト削減を図る。 |
| **AI 生成スキーマの監査**  | AI Builder で生成したスキーマは、本番環境に適用する前に、ビジネス要件と一致しているか必ずレビューする。              |
| **API キーの厳重管理**     | Secret Key はサーバーサイドの環境変数として管理し、クライアントサイドのコードに直接埋め込まない。                    |

---

## 8. 制約と代替案

| 制約事項                   | 説明                                                                                                                                    | 代替案                                                                                                                               |
| :------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------- |
| **バルクアップデート**     | API は一括更新をサポートしない。一括挿入（例: 1,000 件の商品を 1 回の呼び出しで挿入）も非対応。                                         | Zapier や Pabbly などの自動化ツールでループ処理を実装する。Excel ファイルを読み込んで各行ごとに API 呼び出しを行う自動化が可能。     |
| **ファイルストレージ**     | `BLOB`型は非対応。画像や PDF などのファイルは直接保存できない。                                                                         | Amazon S3 などの外部ストレージにファイルをホストし、その URL を DB に保存する。                                                      |
| **サーバーレス関数**       | 独自のバックエンドロジック（トリガーなど）は実行不可。                                                                                  | Vercel や Cloudflare Workers などの外部サービスと組み合わせる。Webhooks を使用してテーブル変更時に外部サービスを呼び出すことも可能。 |
| **リアルタイム通信**       | WebSocket や SSE などのリアルタイムサブスクリプションは利用不可。                                                                       | Pusher や Ably などの外部 Pub/Sub サービスを利用する。Webhooks を使用してテーブル変更を外部サービスに通知することも可能。            |
| **API 経由のスキーマ操作** | API を通じてプログラム的にテーブルやカラムを作成・変更することはできない。                                                              | UI または SQL Playground から操作する必要がある。                                                                                    |
| **API 経由の SQL 実行**    | API 経由で任意の SQL クエリを実行することはできない。                                                                                   | UI 上の SQL Playground を利用する。                                                                                                  |
| **GraphQL / OAuth2**       | 非対応。                                                                                                                                | REST API を利用する。                                                                                                                |
| **SLA と GDPR**            | 公式な SLA(品質保証制度)の記載がなく、GDPR やサーバー所在地に関する情報が不明確な場合がある。DPA（Data Processing Agreement）は作業中。 | 本番環境での利用や個人情報を扱う際は、事前にサポートへ確認することを推奨します。                                                     |
| **バックエンドスタック**   | Next.js と MySQL を使用。Vercel キャッシュにより、国に関係なくすべてのリクエストを高速処理。                                            | RAM は 4GB から 64GB まで動的にスケール（AWS Elastic Services 使用）。ストレージに制限なし。                                         |
