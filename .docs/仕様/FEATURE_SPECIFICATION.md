# KakeiboVibe æ©Ÿèƒ½ä»•æ§˜æ›¸

> ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å…¨æ©Ÿèƒ½ã‚’ç¶²ç¾…çš„ã«è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚
> vibe_coding æ§‹æˆã§ã®å†æ§‹ç¯‰æ™‚ã®å‚ç…§ç”¨ã€‚

---

## æ¦‚è¦

**KakeiboVibe** ã¯ã€MoneyForward ã®CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’å‡¦ç†ã—ã€ä¸–å¸¯ãƒ¡ãƒ³ãƒãƒ¼é–“ã§ã®è²»ç”¨æŒ‰åˆ†ã‚’ç®¡ç†ã™ã‚‹å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

### ä¸»è¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

1. MoneyForward CSVã®å–ã‚Šè¾¼ã¿ãƒ»å‡¦ç†
2. å–å¼•ãƒ‡ãƒ¼ã‚¿ã®é–²è¦§ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
3. ä¸–å¸¯ãƒ¡ãƒ³ãƒãƒ¼é–“ã®è² æ‹…å‰²åˆï¼ˆæŒ‰åˆ†ï¼‰ç®¡ç†
4. å–å¼•ã¸ã®ã‚¿ã‚°ä»˜ã‘
5. ãƒ‡ãƒ¼ã‚¿ã®CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### transactionsï¼ˆå–å¼•ï¼‰

| ã‚«ãƒ©ãƒ             | å‹      | èª¬æ˜                           |
| ----------------- | ------- | ------------------------------ |
| id                | integer | ä¸»ã‚­ãƒ¼ï¼ˆè‡ªå‹•æ¡ç•ªï¼‰             |
| moneyforward_id   | string  | MoneyForwardå›ºæœ‰IDï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰ |
| household_id      | integer | ä¸–å¸¯ID                         |
| transaction_date  | date    | å–å¼•æ—¥ï¼ˆYYYY-MM-DDï¼‰           |
| content           | string  | å–å¼•å†…å®¹                       |
| amount            | integer | é‡‘é¡ï¼ˆå††ï¼‰                     |
| category_id       | integer | ã‚«ãƒ†ã‚´ãƒªIDï¼ˆFKï¼‰               |
| processing_status | string  | å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹                 |
| memo              | string  | ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰                   |

**processing_status ã®å€¤:**

- `æŒ‰åˆ†_å®¶è¨ˆ` - ä¸–å¸¯å…±é€šè²»ç”¨ï¼ˆæŒ‰åˆ†æ¯”ç‡ã§åˆ†å‰²ï¼‰
- `æŒ‰åˆ†_{ãƒ¦ãƒ¼ã‚¶ãƒ¼å}` - å€‹äººè²»ç”¨ï¼ˆ100%ãã®äººè² æ‹…ï¼‰
- `é›†è¨ˆé™¤å¤–_{ç†ç”±}` - é›†è¨ˆã‹ã‚‰é™¤å¤–

### transaction_sharesï¼ˆæŒ‰åˆ†çµæœï¼‰

| ã‚«ãƒ©ãƒ           | å‹      | èª¬æ˜             |
| --------------- | ------- | ---------------- |
| id              | integer | ä¸»ã‚­ãƒ¼           |
| moneyforward_id | string  | å–å¼•IDï¼ˆFKï¼‰     |
| user_id         | integer | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆFKï¼‰ |
| share_amount    | integer | æŒ‰åˆ†é‡‘é¡ï¼ˆå††ï¼‰   |

### transaction_share_overridesï¼ˆæŒ‰åˆ†ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ï¼‰

| ã‚«ãƒ©ãƒ           | å‹      | èª¬æ˜                        |
| --------------- | ------- | --------------------------- |
| id              | integer | ä¸»ã‚­ãƒ¼                      |
| moneyforward_id | string  | å–å¼•IDï¼ˆFKï¼‰                |
| user_id         | integer | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆFKï¼‰            |
| override_type   | string  | `PERCENT` or `FIXED_AMOUNT` |
| value           | integer | å‰²åˆ(%)ã¾ãŸã¯é‡‘é¡           |

**ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„:** `(moneyforward_id, user_id)`

### tagsï¼ˆã‚¿ã‚°ï¼‰

| ã‚«ãƒ©ãƒ        | å‹      | èª¬æ˜   |
| ------------ | ------- | ------ |
| id           | integer | ä¸»ã‚­ãƒ¼ |
| household_id | integer | ä¸–å¸¯ID |
| name         | string  | ã‚¿ã‚°å |

### transaction_tagsï¼ˆå–å¼•ã‚¿ã‚°ç´ä»˜ã‘ï¼‰

| ã‚«ãƒ©ãƒ           | å‹      | èª¬æ˜         |
| --------------- | ------- | ------------ |
| id              | integer | ä¸»ã‚­ãƒ¼       |
| moneyforward_id | string  | å–å¼•IDï¼ˆFKï¼‰ |
| tag_id          | integer | ã‚¿ã‚°IDï¼ˆFKï¼‰ |
| household_id    | integer | ä¸–å¸¯ID       |

**ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„:** `(moneyforward_id, tag_id, household_id)`

### categoriesï¼ˆã‚«ãƒ†ã‚´ãƒªï¼‰

| ã‚«ãƒ©ãƒ      | å‹      | èª¬æ˜               |
| ---------- | ------- | ------------------ |
| id         | integer | ä¸»ã‚­ãƒ¼             |
| major_name | string  | å¤§é …ç›®ï¼ˆä¾‹: é£Ÿè²»ï¼‰ |
| minor_name | string  | ä¸­é …ç›®ï¼ˆä¾‹: å¤–é£Ÿï¼‰ |

### usersï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

| ã‚«ãƒ©ãƒ  | å‹      | èª¬æ˜       |
| ------ | ------- | ---------- |
| id     | integer | ä¸»ã‚­ãƒ¼     |
| name   | string  | ãƒ¦ãƒ¼ã‚¶ãƒ¼å |

### user_aliasesï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥åï¼‰

| ã‚«ãƒ©ãƒ   | å‹      | èª¬æ˜             |
| ------- | ------- | ---------------- |
| id      | integer | ä¸»ã‚­ãƒ¼           |
| user_id | integer | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆFKï¼‰ |
| alias   | string  | è¡¨ç¤ºå           |

### burden_ratiosï¼ˆæŒ‰åˆ†æ¯”ç‡ï¼‰

| ã‚«ãƒ©ãƒ           | å‹      | èª¬æ˜              |
| --------------- | ------- | ----------------- |
| id              | integer | ä¸»ã‚­ãƒ¼            |
| effective_month | string  | é©ç”¨æœˆï¼ˆYYYY-MMï¼‰ |

### burden_ratio_detailsï¼ˆæŒ‰åˆ†æ¯”ç‡è©³ç´°ï¼‰

| ã‚«ãƒ©ãƒ           | å‹      | èª¬æ˜             |
| --------------- | ------- | ---------------- |
| id              | integer | ä¸»ã‚­ãƒ¼           |
| burden_ratio_id | integer | æŒ‰åˆ†æ¯”ç‡IDï¼ˆFKï¼‰ |
| user_id         | integer | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆFKï¼‰ |
| ratio_percent   | integer | è² æ‹…å‰²åˆï¼ˆ%ï¼‰    |

### exclusion_rulesï¼ˆé™¤å¤–ãƒ«ãƒ¼ãƒ«ï¼‰

| ã‚«ãƒ©ãƒ       | å‹      | èª¬æ˜             |
| ----------- | ------- | ---------------- |
| id          | integer | ä¸»ã‚­ãƒ¼           |
| category_id | integer | ã‚«ãƒ†ã‚´ãƒªIDï¼ˆFKï¼‰ |
| rule_type   | string  | ãƒ«ãƒ¼ãƒ«ç¨®åˆ¥       |

---

## ç”»é¢æ§‹æˆ

### ãƒ¡ã‚¤ãƒ³ã‚¿ãƒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KakeiboVibe - Utilities                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å–å¼•è©³ç´°] [ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£] [CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ©Ÿèƒ½è©³ç´°

### 1. å–å¼•è©³ç´°ã‚¿ãƒ–

#### 1.1 ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«

**å¹´æœˆé¸æŠ:**

- å¹´: 2024å¹´ã€œç¾åœ¨å¹´ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰
- æœˆ: 01ã€œ12ï¼ˆå¹´ã«ã‚ˆã£ã¦å‹•çš„ã«åˆ¶é™ï¼‰
  - 2024å¹´ã¯3æœˆä»¥é™ã®ã¿
  - ç¾åœ¨å¹´ã¯ç¾åœ¨æœˆã¾ã§

**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³:**
| ãƒœã‚¿ãƒ³ | æ©Ÿèƒ½ |
|--------|------|
| è¡¨ç¤º | é¸æŠã—ãŸå¹´æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— |
| ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ‰åˆ†ã‚’é©ç”¨ | å…¨å–å¼•ã«å½“æœˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ‰åˆ†ã‚’ä¸€æ‹¬é©ç”¨ |
| å¤‰æ›´ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ | æœªä¿å­˜ã®å¤‰æ›´ã‚’æ°¸ç¶šåŒ– |
| å…¨å–å¼•ã‚’CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | å…¨æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’CSVå‡ºåŠ› |

**è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³:**

- `æŒ‰åˆ†å¯¾è±¡å¤–ã‚’è¡¨ç¤º` ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹

**æƒ…å ±è¡¨ç¤º:**

- ä»Šæœˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ‰åˆ†æ¯”ç‡ï¼ˆä¾‹: `ç¦å³¶ å•“æ–—: 65% / ç¦å³¶ å’Œé¦™: 35%`ï¼‰
- èª­ã¿è¾¼ã¿ä¸­ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- æœªä¿å­˜å¤‰æ›´ä»¶æ•°

#### 1.2 ãƒ”ãƒœãƒƒãƒˆãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º

**6ç¨®é¡ã®ã‚½ãƒ¼ãƒˆ/ã‚°ãƒ«ãƒ¼ãƒ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³:**

| ã‚¿ãƒ–å                      | ã‚°ãƒ«ãƒ¼ãƒ—åŒ–            | ã‚½ãƒ¼ãƒˆ       |
| --------------------------- | --------------------- | ------------ |
| æ—¥ä»˜ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é †          | æ—¥ä»˜ > ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹     | æ—¥ä»˜é™é †     |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»æ—¥ä»˜é †          | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ > æ—¥ä»˜     | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é † |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»ã‚«ãƒ†ã‚´ãƒªé †      | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ > ã‚«ãƒ†ã‚´ãƒª | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é † |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»ã‚«ãƒ†ã‚´ãƒª-é‡‘é¡é † | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ > ã‚«ãƒ†ã‚´ãƒª | é‡‘é¡é †       |
| ã‚«ãƒ†ã‚´ãƒªé †                  | å¤§é …ç›® > ä¸­é …ç›®       | ã‚«ãƒ†ã‚´ãƒªåé † |
| é‡‘é¡é †                      | ãªã—ï¼ˆãƒ•ãƒ©ãƒƒãƒˆï¼‰      | é‡‘é¡é™é †     |

**å„è¡Œã®è¡¨ç¤ºå†…å®¹:**

- æ—¥ä»˜
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆå‡¦ç†åŒºåˆ†ï¼‰
- å†…å®¹ï¼ˆå–å¼•åï¼‰
- ã‚«ãƒ†ã‚´ãƒªï¼ˆå¤§é …ç›® > ä¸­é …ç›®ï¼‰
- é‡‘é¡
- è² æ‹…å‰²åˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
- ã‚¿ã‚°ï¼ˆè¤‡æ•°å¯ï¼‰
- ãƒ¡ãƒ¢ï¼ˆã‚ã‚Œã°ï¼‰

#### 1.3 æŒ‰åˆ†ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼

**æ©Ÿèƒ½:**

- ãƒ‰ãƒ©ãƒƒã‚°ã§æŒ‰åˆ†æ¯”ç‡ã‚’0-100%ã§èª¿æ•´
- ãƒ¦ãƒ¼ã‚¶ãƒ¼1ã®æ¯”ç‡ã‚’è¨­å®š â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼2ã¯è‡ªå‹•è¨ˆç®—ï¼ˆ100 - ãƒ¦ãƒ¼ã‚¶ãƒ¼1ï¼‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§é‡‘é¡è¨ˆç®—ã‚’è¡¨ç¤º

**è‰²åˆ†ã‘:**
| è‰² | çŠ¶æ…‹ |
|----|------|
| ç·‘æ  | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ‰åˆ†ä½¿ç”¨ä¸­ |
| èµ¤æ  | æ‰‹å‹•ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã‚ã‚Š |
| ã‚°ãƒ¬ãƒ¼æ  | è¨ˆç®—æ¸ˆã¿æŒ‰åˆ†ã‚ã‚Š |

**æ“ä½œãƒœã‚¿ãƒ³:**

- ãƒªã‚»ãƒƒãƒˆï¼ˆâ†»ï¼‰: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ‰åˆ†ã«æˆ»ã™
- å‰Šé™¤ï¼ˆğŸ—‘ï¼‰: ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã‚’å‰Šé™¤

#### 1.4 CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**å‡ºåŠ›ã‚«ãƒ©ãƒ :**

```
ID, æ—¥ä»˜, å†…å®¹, é‡‘é¡ï¼ˆå††ï¼‰, ä¿æœ‰é‡‘èæ©Ÿé–¢, å¤§é …ç›®, ä¸­é …ç›®, ãƒ¡ãƒ¢,
YYYYMM, åˆ¤å®š, {ãƒ¦ãƒ¼ã‚¶ãƒ¼1}_æŒ‰åˆ†å‰²åˆ, {ãƒ¦ãƒ¼ã‚¶ãƒ¼2}_æŒ‰åˆ†å‰²åˆ,
{ãƒ¦ãƒ¼ã‚¶ãƒ¼1}_é‡‘é¡æŒ‰åˆ†, {ãƒ¦ãƒ¼ã‚¶ãƒ¼2}_é‡‘é¡æŒ‰åˆ†,
{ãƒ¦ãƒ¼ã‚¶ãƒ¼1}_ä¿®æ­£_æŒ‰åˆ†å‰²åˆ, {ãƒ¦ãƒ¼ã‚¶ãƒ¼2}_ä¿®æ­£_æŒ‰åˆ†å‰²åˆ,
{ãƒ¦ãƒ¼ã‚¶ãƒ¼1}_ä¿®æ­£_æŒ‰åˆ†é‡‘é¡, {ãƒ¦ãƒ¼ã‚¶ãƒ¼2}_ä¿®æ­£_æŒ‰åˆ†é‡‘é¡,
å›ºå®š/å¤‰å‹•, Pivot ç‰¹æ®Šé™¤å¤–ç”¨
```

---

### 2. ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¿ãƒ–

#### 2.1 å–å¼•ã¸ã®ã‚¿ã‚°ä»˜ã‘

**ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼:**

- æœˆå˜ä½ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º
- å„æ—¥ã«å–å¼•åˆè¨ˆé‡‘é¡ã‚’è¡¨ç¤º
- ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
- é€±ã¯æœˆæ›œå§‹ã¾ã‚Š

**æ—¥åˆ¥è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«:**

- ãã®æ—¥ã®å…¨å–å¼•ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
- å„å–å¼•ã«å¯¾ã—ã¦ã‚¿ã‚°ã®è¿½åŠ /å‰Šé™¤ãŒå¯èƒ½
- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å¼ã®ã‚¿ã‚°ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼
- `ã‚¿ã‚°ã®å¤‰æ›´ã‚’ä¿å­˜` ãƒœã‚¿ãƒ³

#### 2.2 ã‚¿ã‚°ã®ç·¨é›†

**ã‚¿ã‚°CRUD:**

- æ–°è¦ä½œæˆ: ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› + ä½œæˆãƒœã‚¿ãƒ³
- ç·¨é›†: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ï¼ˆãƒšãƒ³ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
- å‰Šé™¤: å‰Šé™¤ãƒœã‚¿ãƒ³ + ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:**

- é‡è¤‡åãƒã‚§ãƒƒã‚¯
- ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯

#### 2.3 ä¸€æ‹¬ã‚¿ã‚°ä»˜ã‘

**å…¥åŠ›:**

1. ã‚¿ã‚°é¸æŠï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰
2. MoneyForward IDãƒªã‚¹ãƒˆï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã€1è¡Œ1IDï¼‰

**å‡¦ç†:**

- æŒ‡å®šã—ãŸIDã®å–å¼•ã«ä¸€æ‹¬ã§ã‚¿ã‚°ã‚’ä»˜ä¸
- upsertå‹•ä½œï¼ˆæ—¢å­˜ãªã‚‰æ›´æ–°ï¼‰

---

### 3. CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¿ãƒ–

#### 3.1 ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

**å¯¾å¿œå½¢å¼:**

- MoneyForward CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- æ–‡å­—ã‚³ãƒ¼ãƒ‰: Shift-JIS
- è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«åŒæ™‚é¸æŠå¯

**CSVã‚«ãƒ©ãƒ ï¼ˆMoneyForwardå½¢å¼ï¼‰:**

```
è¨ˆç®—å¯¾è±¡, æ—¥ä»˜, å†…å®¹, é‡‘é¡ï¼ˆå††ï¼‰, ä¿æœ‰é‡‘èæ©Ÿé–¢, å¤§é …ç›®, ä¸­é …ç›®, ãƒ¡ãƒ¢, æŒ¯æ›¿, ID
```

#### 3.2 å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. CSVãƒ‘ãƒ¼ã‚¹
   â†“
2. é‡è¤‡é™¤å»ï¼ˆåŒä¸€IDã¯1ä»¶ã®ã¿ï¼‰
   â†“
3. ã‚«ãƒ†ã‚´ãƒªåˆ¤å®š
   - æ—¢å­˜ã‚«ãƒ†ã‚´ãƒªã«ãƒãƒƒãƒ â†’ ä½¿ç”¨
   - æ–°è¦ã‚«ãƒ†ã‚´ãƒª â†’ æ¤œå‡ºãƒ»ä½œæˆ
   â†“
4. å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®š
   - é™¤å¤–ãƒ«ãƒ¼ãƒ«ã«ãƒãƒƒãƒ â†’ é›†è¨ˆé™¤å¤–
   - ãã‚Œä»¥å¤– â†’ æŒ‰åˆ†åˆ¤å®š
   â†“
5. æŒ‰åˆ†è¨ˆç®—
   - æŒ‰åˆ†_å®¶è¨ˆ â†’ æœˆåˆ¥ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ‰åˆ†é©ç”¨
   - æŒ‰åˆ†_{ãƒ¦ãƒ¼ã‚¶ãƒ¼} â†’ 100%ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
   â†“
6. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜
   - æ–°è¦ â†’ INSERT
   - æ—¢å­˜ â†’ å¤‰æ›´ãŒã‚ã‚Œã°UPDATE
```

#### 3.3 çµæœè¡¨ç¤º

**3ã¤ã®ãƒ“ãƒ¥ãƒ¼:**

1. **è©³ç´°ãƒ“ãƒ¥ãƒ¼**: å…¨å–å¼•ã®ä¸€è¦§ï¼ˆè¡Œç•ªå·ã€å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰
2. **ãƒ”ãƒœãƒƒãƒˆé›†è¨ˆ**: ã‚«ãƒ†ã‚´ãƒªåˆ¥é›†è¨ˆ
3. **ãƒ•ãƒ«ãƒ”ãƒœãƒƒãƒˆ**: å®Œå…¨ãªãƒ”ãƒœãƒƒãƒˆãƒ†ãƒ¼ãƒ–ãƒ«

**çµ±è¨ˆè¡¨ç¤º:**

- æ–°è¦ä½œæˆä»¶æ•°
- æ›´æ–°ä»¶æ•°
- ã‚¹ã‚­ãƒƒãƒ—ä»¶æ•°

**æ–°è¦ã‚«ãƒ†ã‚´ãƒªå¯¾å¿œ:**

- æ¤œå‡ºã•ã‚ŒãŸæ–°è¦ã‚«ãƒ†ã‚´ãƒªã‚’ä¸€è¦§è¡¨ç¤º
- é¸æŠã—ã¦ä¸€æ‹¬ä½œæˆå¯èƒ½
- ä½œæˆå¾Œã«å†å‡¦ç†

---

## APIä»•æ§˜ï¼ˆBackendï¼‰

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

ç¾åœ¨ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ç›´æ¥ NoCodeBackend REST API ã‚’å‘¼ã³å‡ºã—ã€‚

**åŸºæœ¬URL:** `https://ncb.fukushi.ma`

**èªè¨¼:** Bearer Tokenï¼ˆç’°å¢ƒå¤‰æ•° `NCB_API_KEY`ï¼‰

### CRUDæ“ä½œ

| æ“ä½œ     | ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹                   |
| -------- | -------- | ---------------------- |
| ä¸€è¦§å–å¾— | GET      | `/read/{table}`        |
| ä½œæˆ     | POST     | `/create/{table}`      |
| æ›´æ–°     | PATCH    | `/update/{table}/{id}` |
| å‰Šé™¤     | DELETE   | `/delete/{table}/{id}` |

### ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

**ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°:**

```
field[eq]=value      # ç­‰ã—ã„
field[neq]=value     # ç­‰ã—ããªã„
field[gt]=value      # ã‚ˆã‚Šå¤§ãã„
field[gte]=value     # ä»¥ä¸Š
field[lt]=value      # ã‚ˆã‚Šå°ã•ã„
field[lte]=value     # ä»¥ä¸‹
field[in]=a,b,c      # ã„ãšã‚Œã‹
field[like]=value    # éƒ¨åˆ†ä¸€è‡´
```

**ã‚½ãƒ¼ãƒˆ:**

```
sort=field1,field2
order=asc,desc
```

**ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³:**

```
page=1
limit=100
```

### ãƒ¬ãƒ¼ãƒˆåˆ¶é™

- 20ãƒªã‚¯ã‚¨ã‚¹ãƒˆ / 10ç§’
- ä¸¦åˆ—å‡¦ç†: 15ãƒªã‚¯ã‚¨ã‚¹ãƒˆåŒæ™‚
- ãƒãƒƒãƒé–“éš”: 600ms

### ãƒãƒƒãƒå‡¦ç†

**å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®`_in`ã‚¯ã‚¨ãƒª:**

- 30ä»¶ãšã¤ã«åˆ†å‰²
- ä¸¦åˆ—å®Ÿè¡Œï¼ˆ15ãƒªã‚¯ã‚¨ã‚¹ãƒˆåŒæ™‚ï¼‰
- çµæœã‚’ãƒãƒ¼ã‚¸

---

## ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

### æŒ‰åˆ†è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

```typescript
function calculateShares(transaction, users, monthRatioDetails, overrides) {
  // 1. ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ãŒã‚ã‚Œã°å„ªå…ˆ
  if (overrides.length > 0) {
    return applyOverrides(transaction.amount, overrides);
  }

  // 2. æ—¢å­˜ã®æŒ‰åˆ†çµæœãŒã‚ã‚Œã°ä½¿ç”¨
  if (existingShares.length > 0) {
    return existingShares;
  }

  // 3. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ‰åˆ†ã‚’è¨ˆç®—
  if (transaction.processing_status === "æŒ‰åˆ†_å®¶è¨ˆ") {
    // æœˆåˆ¥ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¯”ç‡ã‚’é©ç”¨
    const user1Ratio =
      monthRatioDetails.find((d) => d.user_id === users[0].id)?.ratio_percent ??
      50;
    return [
      { userId: users[0].id, amount: Math.round((amount * user1Ratio) / 100) },
      {
        userId: users[1].id,
        amount: amount - Math.round((amount * user1Ratio) / 100),
      },
    ];
  }

  if (transaction.processing_status.startsWith("æŒ‰åˆ†_")) {
    // ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼100%
    const alias = transaction.processing_status.replace("æŒ‰åˆ†_", "");
    const targetUser = findUserByAlias(alias);
    return [
      { userId: targetUser.id, amount: amount },
      { userId: otherUser.id, amount: 0 },
    ];
  }

  // 4. é›†è¨ˆé™¤å¤–
  return [];
}
```

### å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

```typescript
function determineProcessingStatus(transaction, exclusionRules, users) {
  // é™¤å¤–ãƒ«ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
  const matchedRule = exclusionRules.find(
    (rule) => rule.category_id === transaction.category_id
  );

  if (matchedRule) {
    return `é›†è¨ˆé™¤å¤–_${matchedRule.reason}`;
  }

  // å†…å®¹ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¤å®š
  for (const user of users) {
    if (transaction.content.includes(user.alias)) {
      return `æŒ‰åˆ†_${user.alias}`;
    }
  }

  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å®¶è¨ˆå…±é€š
  return "æŒ‰åˆ†_å®¶è¨ˆ";
}
```

### æ—¥ä»˜ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

```typescript
// NCB APIã®åˆ¶é™å›é¿: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
function filterByMonth(transactions, year, month) {
  const firstDay = `${year}-${month.padStart(2, "0")}-01`;
  const nextMonth = new Date(year, parseInt(month), 1);
  const nextMonthFirstDay = `${nextMonth.getFullYear()}-${String(nextMonth.getMonth() + 1).padStart(2, "0")}-01`;

  return transactions.filter(
    (tx) =>
      tx.transaction_date >= firstDay && tx.transaction_date < nextMonthFirstDay
  );
}
```

---

## çŠ¶æ…‹ç®¡ç†

### ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ï¼ˆAppï¼‰

```typescript
// é¸æŠä¸­ã®å¹´æœˆ
selectedYear: string
selectedMonth: string

// ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–
activeMainTab: 'details' | 'utilities' | 'csv-import'

// ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
masterData: {
  users: User[]
  userAliases: UserAlias[]
  categories: Category[]
  burdenRatios: BurdenRatio[]
  burdenRatioDetails: BurdenRatioDetail[]
  tags: Tag[]
  exclusionRules: ExclusionRule[]
}
```

### å–å¼•ç®¡ç†çŠ¶æ…‹ï¼ˆuseTransactionManagerï¼‰

```typescript
// æœˆåˆ¥ãƒ‡ãƒ¼ã‚¿
monthlyData: {
  transactions: Transaction[]
  transaction_shares: TransactionShare[]
  transaction_share_overrides: TransactionShareOverride[]
  transaction_tags: TransactionTag[]
}

// è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿ï¼ˆenrichedï¼‰
displayTransactions: EnrichedTransaction[]

// æœªä¿å­˜ã®å¤‰æ›´
pendingOverrides: Map<string, number>  // moneyforward_id -> user1ã®%
pendingDeletions: Set<string>          // å‰Šé™¤äºˆå®šã®override
manuallyModifiedIds: Set<string>       // æ‰‹å‹•å¤‰æ›´ã—ãŸID

// UIçŠ¶æ…‹
loading: boolean
loadingMessage: string
saveProgressMessage: string
saveErrors: string[]
saveSuccess: string
```

### ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£çŠ¶æ…‹ï¼ˆuseUtilitiesï¼‰

```typescript
activeUtilTab: 'tagging' | 'editor' | 'bulkTagging'
pendingTagChanges: Map<string, Set<number>>  // moneyforward_id -> tag_ids
modalData: { date: string, transactions: EnrichedTransaction[] }
activeDropdown: string | null
```

---

## UI/UXãƒ‘ã‚¿ãƒ¼ãƒ³

### ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ

```css
/* ãƒ—ãƒ©ã‚¤ãƒãƒªï¼ˆç·‘ç³»ï¼‰ */
--primary: #38a169;
--primary-dark: #1a472a;
--primary-light: #f7fcf7;

/* ã‚»ã‚«ãƒ³ãƒ€ãƒª */
--secondary: #4a7562;

/* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ */
--danger: #c53030;
--success: #48bb78;
--warning: #c05621;
--info: #2c5282;

/* ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ« */
--gray-light: #e2e8f0;
--gray: #718096;
--gray-dark: #4a5568;
```

### ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«

```css
/* ãƒ—ãƒ©ã‚¤ãƒãƒªãƒœã‚¿ãƒ³ */
.btn-primary {
  background: #38a169;
  color: white;
}

/* ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒœã‚¿ãƒ³ */
.btn-secondary {
  background: #4a7562;
  color: white;
}

/* å±é™ºãƒœã‚¿ãƒ³ */
.btn-danger {
  background: #c53030;
  color: white;
}

/* ç„¡åŠ¹çŠ¶æ…‹ */
.btn-disabled {
  background: #d9e9d9;
  color: #8aa88a;
  cursor: not-allowed;
}
```

### ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
loadingMessage: "å–å¼•ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...";
loadingMessage: "é–¢é€£ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­... (938ä»¶)";
loadingMessage: "ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢ä¸­...";

// ä¿å­˜é€²æ—
saveProgressMessage: "ä¿å­˜æº–å‚™ä¸­...";
saveProgressMessage: "åˆ†æ‹…ã‚’ä½œæˆä¸­: 50/100ä»¶...";
saveProgressMessage: "è¡¨ç¤ºã‚’æ›´æ–°ä¸­...";

// æˆåŠŸ/ã‚¨ãƒ©ãƒ¼
saveSuccess: "æ­£å¸¸ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸï¼";
saveErrors: ["ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"];
```

---

## ç’°å¢ƒå¤‰æ•°

```bash
# NoCodeBackendè¨­å®š
NCB_BASE_URL=https://ncb.fukushi.ma
NCB_INSTANCE=52811_kakeibo
NCB_API_KEY=your_api_key_here
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆç¾åœ¨ï¼‰

| æŠ€è¡“          | ç”¨é€”             |
| ------------- | ---------------- |
| React 19      | UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| Vite          | ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«     |
| TypeScript    | å‹å®‰å…¨æ€§         |
| NoCodeBackend | BaaSï¼ˆREST APIï¼‰ |

### ä¾å­˜é–¢ä¿‚

```json
{
  "react": "^19.0.0",
  "react-dom": "^19.0.0",
  "vite": "^6.4.1"
}
```

---

## å†æ§‹ç¯‰æ™‚ã®æ¨å¥¨æ§‹æˆï¼ˆvibe_codingï¼‰

| æŠ€è¡“             | ç¾åœ¨               | æ¨å¥¨                |
| ---------------- | ------------------ | ------------------- |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰     | ãªã—ï¼ˆç›´æ¥APIï¼‰    | **Hono**            |
| ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°     | æ‰‹å‹•               | **TanStack Router** |
| çŠ¶æ…‹ç®¡ç†         | useState/useEffect | **TanStack Query**  |
| ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°     | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³CSS      | **Tailwind CSS**    |
| UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | è‡ªä½œ               | **shadcn/ui**       |
| å‹å…±æœ‰           | ãªã—               | **Hono RPC**        |

### ç§»è¡Œãƒ¡ãƒªãƒƒãƒˆ

1. **APIã‚­ãƒ¼ã®ä¿è­·**: Honoãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰çµŒç”±ã§NCBã‚¢ã‚¯ã‚»ã‚¹
2. **å‹å®‰å…¨æ€§å‘ä¸Š**: Hono RPC + TanStack Router
3. **ã‚³ãƒ¼ãƒ‰ç°¡æ½”åŒ–**: TanStack Queryã§useEffectå‰Šæ¸›
4. **UIçµ±ä¸€**: Tailwind + shadcn/uiã§ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ åŒ–

---

## ä»˜éŒ²: MoneyForward CSVå½¢å¼

```csv
è¨ˆç®—å¯¾è±¡,æ—¥ä»˜,å†…å®¹,é‡‘é¡ï¼ˆå††ï¼‰,ä¿æœ‰é‡‘èæ©Ÿé–¢,å¤§é …ç›®,ä¸­é …ç›®,ãƒ¡ãƒ¢,æŒ¯æ›¿,ID
1,2025/01/15,ã‚³ãƒ³ãƒ“ãƒ‹,-500,ç¾é‡‘,é£Ÿè²»,é£Ÿæ–™å“,,0,ABC123...
0,2025/01/14,çµ¦ä¸æŒ¯è¾¼,300000,éŠ€è¡ŒA,åå…¥,çµ¦ä¸,,0,DEF456...
```

| ã‚«ãƒ©ãƒ        | èª¬æ˜                         |
| ------------ | ---------------------------- |
| è¨ˆç®—å¯¾è±¡     | 1=å¯¾è±¡, 0=å¯¾è±¡å¤–             |
| æ—¥ä»˜         | YYYY/MM/DDå½¢å¼               |
| å†…å®¹         | å–å¼•å                       |
| é‡‘é¡ï¼ˆå††ï¼‰   | æ”¯å‡ºã¯ãƒã‚¤ãƒŠã‚¹ã€åå…¥ã¯ãƒ—ãƒ©ã‚¹ |
| ä¿æœ‰é‡‘èæ©Ÿé–¢ | å£åº§å                       |
| å¤§é …ç›®       | ã‚«ãƒ†ã‚´ãƒªå¤§åˆ†é¡               |
| ä¸­é …ç›®       | ã‚«ãƒ†ã‚´ãƒªå°åˆ†é¡               |
| ãƒ¡ãƒ¢         | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ¢                 |
| æŒ¯æ›¿         | 0=é€šå¸¸, 1=æŒ¯æ›¿               |
| ID           | MoneyForwardå›ºæœ‰ID           |
